---
# hashistack prepare playbook
- name: "Bootstrap"
  hosts: all
  gather_facts: true
  become: true
  tasks:
    - name: "Install hvac library with pip"
      ansible.builtin.include_role:
        name: ednz_cloud.manage_pip_packages
      vars:
        manage_pip_packages_install_prereqs: true
        manage_pip_packages_list:
          - name: hvac
            version_constraint: latest
            state: present
      when: "'vault_servers' in group_names"

    - name: "Install python-consul library with pip"
      ansible.builtin.include_role:
        name: ednz_cloud.manage_pip_packages
      vars:
        manage_pip_packages_install_prereqs: true
        manage_pip_packages_list:
          - name: python-consul
            version_constraint: latest
            state: present
      when: "'haproxy_servers' in group_names"

    - name: "Include ednz_cloud.install_docker"
      ansible.builtin.include_role:
        name: ednz_cloud.install_docker
      vars:
        install_docker_edition: ce
        install_docker_auto_update: false
        install_docker_start_service: true
        install_docker_compose: false
        install_docker_compose_version: latest
        install_docker_python_packages: true
        install_docker_python_packages_version: latest
        install_docker_users:
          - "{{ ansible_user }}"
        install_docker_daemon_options: {}
      when: deployment_method == 'docker'

    - name: "Ensure /etc/localtime exists"
      ansible.builtin.file:
        src: /etc/timezone
        dest: /etc/localtime
        owner: root
        group: root
        state: link
