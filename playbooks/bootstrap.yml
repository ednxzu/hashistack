---
# hashistack prepare playbook
- name: "Bootstrap"
  hosts: all, !deployment
  gather_facts: true
  become: true
  tasks:
    - name: "Isntall unzip with package manager"
      ansible.builtin.include_role:
        name: ednz_cloud.manage_apt_packages
      vars:
        manage_apt_packages_list:
          - name: unzip
            version: latest
            state: present

    - name: "Install hvac library with pip"
      ansible.builtin.include_role:
        name: ednz_cloud.manage_pip_packages
      vars:
        manage_pip_packages_install_prereqs: true
        manage_pip_packages_list:
          - name: hvac
            version_constraint: latest
            state: present
      when: "'vault_servers' in group_names"

    - name: "Install python-consul library with pip"
      ansible.builtin.include_role:
        name: ednz_cloud.manage_pip_packages
      vars:
        manage_pip_packages_install_prereqs: true
        manage_pip_packages_list:
          - name: python-consul
            version_constraint: latest
            state: present
      when: "'haproxy_servers' in group_names"

    - name: "Ensure /etc/localtime exists"
      ansible.builtin.file:
        src: /etc/timezone
        dest: /etc/localtime
        owner: root
        group: root
        state: link
